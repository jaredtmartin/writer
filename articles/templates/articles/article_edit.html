{% extends "writeaid_base.html" %}
{% block head %}
    <script type="text/javascript" src="{{ STATIC_URL}}js/tiny_mce/jquery.tinymce.js"></script>
    <link href="{{ STATIC_URL}}css/writersaxis.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="{{ STATIC_URL}}js/ajax.js"></script>
    <script type="text/javascript">
        $('#new-project-form').submit(function() {
          return false;
        });
        function createProject(){
            // data={
            //     name:$('#new_project_name_input'),
            // };
            // jQuery.post({
            //     url:"{% url new_project %}", 
            //     data:{name:$('#new_project_name_input')}, 
            //     success:confirmProjectCreation,
            // });
            $.post('{% url new_project %}', {name: $('#new_project_name_input').val()}, function(data) {
                d=saveDataInCache(data);
                updateMessages(d); 
                result=$('#new-project-name', data).val();
            });
        }
        function confirmProjectCreation(){
        }

    </script>
{% endblock %}

{% block content %}
    <div id="article">
        {{form.errors}}
        <form action="{{ article.get_absolute_url }}" method="post"> {% csrf_token %}
        {{form.ID}}
        <input type="hidden" name="owner" value="{% if article.owner %}{{article.owner.pk}}{% else %}{{user.pk}}{% endif %}">
        <div class="block">
            <div class="block_head">
                <div class="bheadl"></div>
                <div class="bheadr"></div>
                <div class="table-header" style="width:90%;">
                    <h2>{% if article.pk %} Article: {{article.name}} {% else %} New Article {% endif %}</h2>
                    <div class="non-header" style="float:right;">
                        <a href="{% url article_list %}">Back to Article List</a>
                    </div>
                </div>
            </div>
            <div class="span2">
                <div class="btn-group">
                    <a class="btn" href="{% url article_list %}"><i class="icon-chevron-left"></i></a>
                    <a class="btn" href="{% url article_list %}"><i class="icon-chevron-right"></i></a>
                </div>
            </div>
        </div>
        {% if user == article.owner or not article.pk %}
            <div class="row-fluid">
                <div class="span12"><legend>Properties:</legend></div>
            </div>
            <div class="row-fluid">
                <div class="span3">Minimum</div>
                <div class="span3">{{ form.minimum }}</div>
                <div class="span3">Maximum</div>
                <div class="span3">{{ form.maximum }}</div>
            </div>
            <div class="row-fluid">
                <div class="span3">Type</div>
                <div class="span3">{{ form.article_type }}</div>
                <div class="span3">Project</div>
                <div class="span3">{{ form.project }} <a href="#new-project-modal" class="btn btn-small btn-success" role="button" data-toggle="modal"><i class="icon-plus icon-white"></i></a></div>
            </div>
            <div class="row-fluid">
                {% include "articles/edit_articles_tags.html" %}
            </div>
            {% if article.pk %}
                <div class="row-fluid">
                    <div class="span12"><legend>Keywords:</legend></div>
                </div>
                <div class="row-fluid">
                    {% with inlines.0 as inline %}
                        {% include "articles/edit_article_keywords_form.html" %}
                    {% endwith %}
                {% else %}
                    {% include "articles/show_article_properties.html"%}
                {% endif %}
                <table class="block_content" width="100%" cellspacing="0" cellpadding="0" border="0" style="border: none; margin:0;">
                    <tr>
                        <td>
                            <ul class="priority">
                                {% for action in article.available_actions %}
                                    <a href="#" onclick="jQuery.post('{{article.get_absolute_url}}{{action}}/', success=ajaxUpdateRow);return false;"><li title="" class="blue-keyword">{{action}}</li></a>
                                {% endfor %}
                            </ul>
                        </td>
                    </tr>
                </table>
                {% if article.assigned %}
                    {% include "articles/article_body.html" %}
                {% endif %}
                {% include "articles/confirm_delete.html" %}
                <table class="block_content" width="100%" cellspacing="0" cellpadding="0" border="0" style="border: none; margin:0;">
                    <tr>
                        {% for action in article.available_actions %}
                            {% if action.1 %}
                                <td><a id="{{action}}-button" href="#{{action}}-popup"><input type="button" value="{{action.title}}" class="submit long"></a></td>
                                <div id="delete-popup" style="display:none">
                                <div id="{{action}}-box">
                                    {{action.1}}
                                    <a class="button continue-button" onclick="{{object.get_delete_url}}">{{action}}</a>
                                </div>
                            </div>
                            <script>
                                $(document).ready(function() {
                                    $("a#delete-button").fancybox();
                                });
                            </script>
                            {% else %}
                                <td><a id="{{action}}-button" href="{{article.get_absolute_url}}{{action}}/"><input type="button" value="{{action.title}}" class="submit long"></a></td>
                            {% endif %}
                        {% endfor %}
                        <td><a id="delete-button" href="#delete-popup"><input type="button" value="Delete" class="submit long"></a></td>
                        <td><div class="aright"><input type="submit" value="Save Article" class="submit long"></div></td>
                    </tr>
                </table>
            </div>
            <div class="bendl"></div>
            <div class="bendr"></div>
        </div>
    </div>
    <div id="new-project-modal" class="modal  fade">
        <form id="new-project-form">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3>New Project</h3>
            </div>
            <div class="modal-body">
                <p>Enter the name of the new project.</p>
                <input id="new_project_name_input" name="name">
            </div>
            <div class="modal-footer">
                <a href="#" class="btn btn-primary" onclick="createProject();return false;">Create</a>
                <a href="#" class="btn btn-primary" onclick="$('#new-project-modal').modal('hide');">Cancel</a>
            </div>
        </form>
    </div>
{% endblock %}
