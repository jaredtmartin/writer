{% extends "articles/base.html" %}
{% load actions %}
{% load project_list %}
{% block head %}
    <script type="text/javascript" src="{{ STATIC_URL}}js/tiny_mce/jquery.tinymce.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL}}js/ajax.js"></script>
    <script type="text/javascript">
        $('#new-project-form').submit(function() {
          return false;
        });
        function createProject(){
            // data={
            //     name:$('#new_project_name_input'),
            // };
            // jQuery.post({
            //     url:"{% url new_project %}", 
            //     data:{name:$('#new_project_name_input')}, 
            //     success:confirmProjectCreation,
            // });
            $.post('{% url new_project %}', {name: $('#new_project_name_input').val()}, function(data) {
                d=saveDataInCache(data);
                updateMessages(d); 
                result=$('#new-project-name', d).val();
                $('#id_project').val(result);
                $('#new-project-modal').modal('hide');
            });
        }
    </script>
{% endblock %}
{% block navbar %}
  <li><a href="{% url article_add %}">Add Article</a></li>
{% endblock %}
{% block content %}
    <div id="article">
        {{form.errors}}
        <form  action="{{ article.get_absolute_url }}" method="post"> {% csrf_token %}
        {{form.ID}}
        <input type="hidden" name="owner" value="{% if article.owner %}{{article.owner.pk}}{% else %}{{user.pk}}{% endif %}">
        <div class="row-fluid">
            <div class="span10">
                <div class="page-header">
                    <h1>{% if article.pk %} Article: {{article.name}} {% else %} New Article {% endif %}</h1>
                </div>
            </div>
            <div class="span2">
                <div class="btn-group">
                    <a class="btn" href="{% url article_list %}"><i class="icon-chevron-left"></i></a>
                    <a class="btn" href="{% url article_list %}"><i class="icon-chevron-right"></i></a>
                </div>
            </div>
        </div>
        {% if user == article.owner or not article.pk %}
            <div class="row-fluid">
                <div class="span12"><legend>Properties:</legend></div>
            </div>
            <div class="row-fluid">
                <div class="span1 input-label">Minimum:</div>
                <div class="span2">{{ form.minimum }}</div>
                <div class="span1 input-label">Maximum:</div>
                <div class="span2">{{ form.maximum }}</div>
                <div class="span1 input-label">Type:</div>
                <div class="span2">{{ form.article_type }}</div>
                <div class="span1 input-label">Project:</div>
                <div class="span2">
                    <input id="id_project" name="project" type="text" value="{{ article.project }}" data-provide="typeahead" data-source='{% project_list %}'>
                </div>
            </div>
            <div class="row-fluid">
            </div>
            <div class="row-fluid">
                <div class="span2">Tags: {% if user = article.owner or not article.pk %}<a href="#">(Change)</a>{% endif %}</div>
                <div class="span4" id="tags-list">
                    {% for tag in article.tags %}
                        {% if tag %}
                            <a class="badge badge-small btn-tag" href="{% url article_list %}?q={{tag}}" title="Click here to see all articles with this tag">{{tag}}</a>
                        {% endif %}
                    {% endfor %}
                </div>
                
                <div class="span2">Description</div>
                <div class="span4">{{form.description}}</div>
            </div>
            <div class="row-fluid">
                <div class="span2">Notes to Writer</div>
                <div class="span4">{{form.article_notes}}</div>
                <div class="span2">Notes to Reviewer</div>
                <div class="span4">{{form.review_notes}}</div>
            </div>
            {% if article.pk %}
                <div class="row-fluid">
                    <div class="span12"><legend>Keywords:</legend></div>
                </div>
                <div class="row-fluid">
                    {% with inlines.0 as inline %}
                        {% include "articles/edit_article_keywords_form.html" %}
                    {% endwith %}
                </div>
            {% endif %}
        {% else %}
            <div class="row-fluid">
                <div class="span1 input-label">Minimum:</div>
                <div class="span2">{{article.minimum}}</div>
                <div class="span1 input-label">Maximum:</div>
                <div class="span2">{{ article.maximum }}</div>
                <div class="span1 input-label">Type:</div>
                <div class="span2">{{ article.article_type }}</div>
                <div class="span1 input-label">Project:</div>
                <div class="span2">{{ article.project }}</div>
            </div>
        {% endif %}
        {% if user = article.assigned.author %}
            {% include "articles/article_body.html" %}
        {% endif %}
        {% if article.pk %}
            <div class="row-fluid">
                <div class="span12"><legend>Last Action:</legend></div>
            </div>
            <div class="row-fluid">
                <div class="span12">{{article.last_action}}</div>
            </div>
        {% endif %}
        <div class="row-fluid">
            <div class="span12"><legend>Available Actions:</legend></div>
        </div>
        <div class="row-fluid">
            <div class="span12">
                {% show_actions %}
                <button class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>
    <!-- <div id="new-project-modal" class="modal  fade">
        <form id="new-project-form">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3>New Project</h3>
            </div>
            <div class="modal-body">
                <p>Enter the name of the new project.</p>
                <input id="new_project_name_input" name="name">
            </div>
            <div class="modal-footer">
                <a href="#" class="btn btn-primary" onclick="createProject();return false;">Create</a>
                <a href="#" class="btn btn-primary" onclick="$('#new-project-modal').modal('hide');">Cancel</a>
            </div>
        </form>
    </div> -->
{% endblock %}
