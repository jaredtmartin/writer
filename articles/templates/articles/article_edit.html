{% extends "articles/base.html" %}
{% load actions %}
{% load project_list %}
{% load can_edit %}
{% block head %}
    <script src="{{STATIC_URL}}js/ckeditor/ckeditor.js"></script>
    <script type="text/javascript">
        $().ready(function() {
            $( "#id_expires" ).datepicker();
            {% if user|can_edit:article %}
                CKEDITOR.replace("id_body", {"filebrowserWindowWidth": 940, "width": 835, "filebrowserWindowHeight": 725, "filebrowserBrowseUrl": "/ckeditor/browse/", "filebrowserUploadUrl": "/ckeditor/upload/", "toolbar": "Full", "height": 291});
            {% endif %} 
        });
        function showSection(section_id){
            $('#'+section_id+'-cell').show();
            $('#'+section_id+'-cell').parent().show();
            $('#'+section_id+'-option').hide();
            if($('.add-details-option:visible').length == 0){$('#add-details-selector').hide();}
        }
    </script>
    
{% endblock %}
{% block navbar %}
  <li><a href="{% url article_add %}">Add Article</a></li>
{% endblock %}
{% block content %}
    <div id="article">
        {{form.errors}}
        <form  action="{{ article.get_absolute_url }}" method="post"> {% csrf_token %}
            {{form.ID}}
            <input type="hidden" name="owner" value="{% if article.owner %}{{article.owner.pk}}{% else %}{{user.pk}}{% endif %}">
            <div class="row-fluid">
                <div class="span12">
                    <div class="page-header">
                        <h1>{% if article.pk %} Article: {{article.name}} {% else %} New Article {% endif %}</h1>
                    </div>
                </div>
            </div>
            {% if user == article.owner and user.mode == 2 or not article.pk %}
                <div class="row-fluid">
                    <div class="span1 input-label">Project:</div>
                    <div class="span3">{{ form.project }}</div>

                    <div class="span1 input-label">Type:</div>
                    <div class="span3">{{ form.article_type }}</div>

                    <div class="span1 input-label">Category:</div>
                    <div class="span3">{{ form.category }}</div>
                </div>

                <div class="row-fluid">
                    <div class="span1 input-label">Writer:</div>
                    <div class="span3">
                        <div class="btn-group">
                            <a class="btn btn-small dropdown-toggle" data-toggle="dropdown" href="#">
                                {% if article.writer %}{{article.writer.full_name}}{% else %}{{article.status}}{% endif %} <span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">
                                <li><a tabindex="-1" href="#">Unavailable</a></li>
                                <li><a tabindex="-1" href="#">Available</a></li>
                                <li class="dropdown-submenu">
                                    <a tabindex="-1" href="#">Make Available to</a>
                                    <ul class="dropdown-menu">
                                        {% for writer in user.writers %}
                                            <li><a tabindex="-1" href="#">{{writer.writer.full_name}}</a></li>
                                        {% endfor %}
                                    </ul>
                                </li>
                                <li class="dropdown-submenu">
                                    <a tabindex="-1" href="#">Assign to</a>
                                    <ul class="dropdown-menu">
                                        {% for writer in user.writers %}
                                            <li><a tabindex="-1" href="#">{{writer.writer.full_name}}</a></li>
                                        {% endfor %}
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="span1 input-label">Reviewer:</div>
                    <div class="span3">
                        <div class="btn-group">
                            <a class="btn btn-small dropdown-toggle" data-toggle="dropdown" href="#">
                                Available to Taiye's Group <span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">
                                <li><a tabindex="-1" href="#">Unavailable</a></li>
                                <li><a tabindex="-1" href="#">Available</a></li>
                                <li class="dropdown-submenu">
                                    <a tabindex="-1" href="#">Make Available to</a>
                                    <ul class="dropdown-menu">
                                        {% for reviewer in user.reviewers %}
                                            <li><a tabindex="-1" href="#">{{reviewer.reviewer.full_name}}</a></li>
                                        {% endfor %}
                                    </ul>
                                </li>
                                <li class="dropdown-submenu">
                                    <a tabindex="-1" href="#">Assign to</a>
                                    <ul class="dropdown-menu">
                                        {% for reviewer in user.reviewers %}
                                            <li><a tabindex="-1" href="#">{{reviewer.reviewer.full_name}}</a></li>
                                        {% endfor %}
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="span1 input-label">Priority:</div>
                    <div class="span2">{{ form.priority }}</div>
                </div>
                <div class="row-fluid">
                    <div class="span1 input-label">Description</div>
                    <div class="span7">{{form.description}}</div>

                    <div class="span1 input-label">Length:</div>
                    <div class="span3">{{ form.minimum }}</div>
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        {% with inlines.0 as inline %}
                            {% include "articles/edit_article_keywords_form.html" %}
                        {% endwith %}
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span2 input-label">Notes to Writer</div>
                    <div class="span10">{{form.article_notes}}</div>
                </div>
                <div class="row-fluid">
                    <div class="span2 input-label">Notes to Reviewer</div>
                    <div class="span10">{{form.review_notes}}</div>
                </div>
                <div id="add-details-selector" class="btn-group">
                    <a class="btn dropdown-toggle btn-small" data-toggle="dropdown">Add Details <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li class="add-details-option" id="date-option"><a tabindex="-1" onclick="showSection('date');">Date Due</a></li>
                        <li class="add-details-option" id="tags-option"><a tabindex="-1" onclick="showSection('tags');">Tags</a></li>
                        <li class="add-details-option" id="purpose-option"><a tabindex="-1" onclick="showSection('purpose');">Purpose</a></li>
                        <li class="add-details-option" id="referrals-option"><a tabindex="-1" onclick="showSection('referrals');">Referral Links</a></li>
                        <li class="add-details-option" id="price-option"><a tabindex="-1" onclick="showSection('price');">Price per Item</a></li>
                        <li class="add-details-option" id="lang-option"><a tabindex="-1" onclick="showSection('lang');">Language</a></li>
                        <li class="add-details-option" id="style-option"><a tabindex="-1" onclick="showSection('style');">Style</a></li>
                    </ul>
                </div>
                <div class="row-fluid">
                    <div id="date-cell" class="hidden-cell">
                        <div class="span2 input-label">Date Due</div>
                        <div class="span2">{{form.expires}}</div>
                    </div>
                    <div id="tags-cell" class="hidden-cell">
                        <div class="span2 input-label">Tags</div>
                        <div class="span6">{{form.tags}}</div>
                    </div>
                </div>
                <div class="row-fluid">
                    <div id="purpose-cell" class="hidden-cell">
                        <div class="span2 input-label">Purpose</div>
                        <div class="span2">{{form.purpose}}</div>
                    </div>
                    <div id="referrals-cell" class="hidden-cell">
                        <div class="span2 input-label">Referral Links</div>
                        <div class="span2">{{form.referrals}}</div>
                    </div>
                    <div id="price-cell" class="hidden-cell">
                        <div class="span2 input-label">Price per Item</div>
                        <div class="span2">{{form.price}}</div>
                    </div>
                </div>
                <div class="row-fluid">
                    <div id="lang-cell" class="hidden-cell">
                        <div class="span2 input-label">Language</div>
                        <div class="span2">{{form.language}}</div>
                    </div>
                    <div id="style-cell" class="hidden-cell">
                        <div class="span2 input-label">Style</div>
                        <div class="span2">{{form.style}}</div>
                    </div>
                </div>

            {% else %}
                <div class="row-fluid">
                    <div class="span1 input-label">Project:</div>
                    <div class="span2">{{ article.project }}</div>

                    <div class="span1 input-label">Type:</div>
                    <div class="span3">{{ article.article_type }}</div>

                    <div class="span1 input-label">Category:</div>
                    <div class="span3">{{ article.category }}</div>
                </div>

                <div class="row-fluid">
                    <div class="span1 input-label">Writer:</div>
                    {% if article.writer %}
                        <div class="span2">{{ article.writer.full_name }}</div>
                    {% else %}
                        <div class="span2">None</div>
                    {% endif %}

                    <div class="span1 input-label">Reviewer:</div>
                    {% if article.reviewer %}
                        <div class="span2">{{ article.reviewer.full_name }}</div>
                    {% else %}
                        <div class="span2">None</div>
                    {% endif %}

                    <div class="span1 input-label">Priority:</div>
                    <div class="span2">{{ article.priority }}</div>
                </div>
                <div class="row-fluid">
                    <div class="span1 input-label">Description</div>
                    <div class="span7">{{article.description}}</div>

                    <div class="span1 input-label">Length:</div>
                    <div class="span3">{{ article.minimum }}</div>
                </div>
                {% for keyword in article.keyword_set.all %}
                    <div class="row-fluid">
                        <div class="span1 input-label">Keyword:</div>
                        <div class="span2">{{keyword.keyword}} (x{{ keyword.times }})</div>
                    </div>
                {% endfor %}
                {% if user == article.writer and article.article_notes%}
                    <div class="row-fluid">
                        <div class="span1 input-label">Notes to Writer</div>
                        <div class="span11">{{article.article_notes}}</div>
                    </div>
                {% endif %}
                {% if user == ariticle.reviewer and article.review_notes%}
                    <div class="row-fluid">
                        <div class="span1 input-label">Notes to Reviewer</div>
                        <div class="span11">{{article.review_notes}}</div>
                    </div>
                {% endif %}
                {% if article.expires or article.tags %}
                <div class="row-fluid">
                    <div id="date-cell" class="hidden-cell">
                        <div class="span2 input-label">Date Due</div>
                        <div class="span2">{{article.expires}}</div>
                    </div>
                    <div id="tags-cell" class="hidden-cell">
                        <div class="span2 input-label">Tags</div>
                        <div class="span6">{{article.tags}}</div>
                    </div>
                </div>
                {% endif %}
                {% if article.purpose or article.referrals or article.price %}
                <div class="row-fluid">
                    <div id="purpose-cell" class="hidden-cell">
                        <div class="span2 input-label">Purpose</div>
                        <div class="span2">{{article.purpose}}</div>
                    </div>
                    <div id="referrals-cell" class="hidden-cell">
                        <div class="span2 input-label">Referral Links</div>
                        <div class="span2">{{article.referrals}}</div>
                    </div>
                    <div id="price-cell" class="hidden-cell">
                        <div class="span2 input-label">Price per Item</div>
                        <div class="span2">{{article.price}}</div>
                    </div>
                </div>
                {% endif %}
                {% if article.language or article.style %}
                <div class="row-fluid">
                    <div id="lang-cell" class="hidden-cell">
                        <div class="span2 input-label">Language</div>
                        <div class="span2">{{article.language}}</div>
                    </div>
                    <div id="style-cell" class="hidden-cell">
                        <div class="span2 input-label">Style</div>
                        <div class="span2">{{article.style}}</div>
                    </div>
                </div>
                {% endif %}
            {% endif %}
            <div class="row-fluid">
                <div class="span12"><legend>Actions:</legend></div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    {% show_edit_page_actions %}
                </div>
            </div>
            {% if user|can_edit:article %}
                <div class="row-fluid">
                    <div class="span12"><legend>Content:</legend></div>
                </div>
                <div class="row-fluid">
                    <div class="span2">Title</div>
                    <div class="span9 long-input">{{form.title}}</div>
                </div>
                <div class="row-fluid">
                    <div class="span12 well">
                        <textarea id="id_body" name="body">
                            {{form.instance.body}}
                        </textarea>
                    </div>
                </div>
            {% endif %}
        </form>
    </div>
{% endblock %}
