{% extends "articles/base.html" %}
{% load actions %}
{% load project_list %}
{% load can_edit %}
{% block head %}
    <script src="{{STATIC_URL}}js/ckeditor/ckeditor.js"></script>
    <script type="text/javascript">
        $().ready(function() {
            // CKEDITOR.replace( 'editor1' );
            CKEDITOR.replace("id_body", {"filebrowserWindowWidth": 940, "width": 835, "filebrowserWindowHeight": 725, "filebrowserBrowseUrl": "/ckeditor/browse/", "filebrowserUploadUrl": "/ckeditor/upload/", "toolbar": "Full", "height": 291});
        });
        function showSection(section_id){
            $('#'+section_id).collapse('show');
            
        }
    </script>
{% endblock %}
{% block navbar %}
  <li><a href="{% url article_add %}">Add Article</a></li>
{% endblock %}
{% block content %}
    <div id="article">
        {{form.errors}}
        <form  action="{{ article.get_absolute_url }}" method="post"> {% csrf_token %}
            {{form.ID}}
            <input type="hidden" name="owner" value="{% if article.owner %}{{article.owner.pk}}{% else %}{{user.pk}}{% endif %}">
            <div class="row-fluid">
                <div class="span10">
                    <div class="page-header">
                        <h1>{% if article.pk %} Article: {{article.name}} {% else %} New Article {% endif %}</h1>
                    </div>
                </div>
                <div class="span2">
                    <div class="btn-group">
                        <a class="btn" href="{% url article_list %}"><i class="icon-chevron-left"></i></a>
                        <a class="btn" href="{% url article_list %}"><i class="icon-chevron-right"></i></a>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span4">
                    More:
                    <select>
                        <option onclick="$('#limits_section').collapse('show');return false;">Limits</option>
                        <option onclick="$('#category_section').collapse('show');return false;">Tags & Projects</option>
                        <option onclick="$('#notes_section').collapse('show');return false;">Notes</option>
                    </select>   
                </div>
            </div>
            {% if article.pk %}
                <div class="row-fluid">
                    <div class="span2 input-label">Writer:</div>
                    <div class="span2">{% if article.writer %}{{article.writer.full_name}}{% else %} No writer assigned.{% endif %}</div>
                    {% if user == article.owner or user == article.reviewer %}
                        <div class="span2 input-label">Reviewer:</div>
                        <div class="span2">{% if article.reviewer %}{{article.reviewer.full_name}}{% else %} No reviewer assigned.{% endif %}</div>
                    {% endif %}
                </div>
            {% endif %}
            {% if user == article.owner or not article.pk %}
                <div class="row-fluid">
                    <div class="span2 input-label">Type:</div>
                    <div class="span4">{{ form.article_type }}</div>
                    {% if not article.pk %}
                        <div class="span2">Number of Articles</div>
                        <div class="span4">{{form.number_of_articles}}</div>
                    {% endif %}
                </div>
                <div class = "collapse-group">
                    <!--<a data-toggle="collapse" data-target="#limits_section">
                        <div class="row-fluid">
                            <div class="span12"><legend>Limits: <span class="legend-note">(Click here to expand)</span></legend></div>
                        </div>
                    </a> -->
                    <div class="collapse" id="limits_section">
                        <div class="row-fluid">
                            <div class="span2 input-label">Minimum:</div>
                            <div class="span4">{{ form.minimum }}</div>
                            <div class="span2 input-label">Maximum:</div>
                            <div class="span4">{{ form.maximum }}</div>
                        </div>
                    </div>
                </div>

                <div class = "collapse-group">
                    <!--<a data-toggle="collapse" data-target="#category_section">
                        <div class="row-fluid">
                            <div class="span12"><legend>Tags & Projects: <span class="legend-note">(Click here to expand)</span></legend></div>
                        </div>
                    </a>-->
                    <div class="collapse" id="category_section">
                        <div class="row-fluid">
                            <div class="span2 input-label">Project:</div>
                            <div class="span4">
                                <input id="id_project" name="project" type="text" value="{{ article.project }}" data-provide="typeahead" data-source='{% project_list %}'>
                            </div>
                            <div class="row-fluid">
                                <div class="span2 input-label">Tags:</div>
                                <div class="span4">{{form.tags}}</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class = "collapse-group">
                    <!--<a data-toggle="collapse" data-target="#notes_section">
                        <div class="row-fluid">
                            <div class="span12"><legend>Notes: <span class="legend-note">(Click here to expand)</span></legend></div>
                        </div>
                    </a>-->
                    <div class="collapse" id="notes_section">
                        <div class="row-fluid">
                            <div class="span2 input-label">Description</div>
                            <div class="span9">{{form.description}}</div>
                        </div>
                        <div class="row-fluid">
                            <div class="span2 input-label">Notes to Writer</div>
                            <div class="span9">{{form.article_notes}}</div>
                        </div>
                        <div class="row-fluid">
                            <div class="span2 input-label">Notes to Reviewer</div>
                            <div class="span9">{{form.review_notes}}</div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span12"><legend>Keywords:</legend></div>
                </div>
                <div class="row-fluid">
                    {% with inlines.0 as inline %}
                        {% include "articles/edit_article_keywords_form.html" %}
                    {% endwith %}
                </div>
            {% else %}
                <div class="row-fluid">
                    <div class="span2 input-label">Minimum:</div>
                    <div class="span2">{{article.minimum}}</div>
                    <div class="span2 input-label">Maximum:</div>
                    <div class="span2">{{ article.maximum }}</div>
                    <div class="span2 input-label">Type:</div>
                    <div class="span2">{{ article.article_type }}</div>
                </div>
                {% if article.description %}
                    <div class="row-fluid">
                        <div class="span2 input-label">Description</div>
                        <div class="span10">{{article.description}}</div>
                    </div>
                {% endif %}
                {% if user == article.writer and article.article_notes%}
                    <div class="row-fluid">
                        <div class="span2 input-label">Notes to Writer</div>
                        <div class="span10">{{article.article_notes}}</div>
                    </div>
                {% endif %}
                {% if user == ariticle.reviewer and article.review_notes%}
                    <div class="row-fluid">
                        <div class="span2 input-label">Notes to Reviewer</div>
                        <div class="span10">{{article.review_notes}}</div>
                    </div>
                {% endif %}
            {% endif %}
            <div class="row-fluid">
                <div class="span12"><legend>Actions:</legend></div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    {% show_edit_page_actions %}
                </div>
            </div>
            {% if user|can_edit:article %}
                <div class="row-fluid">
                    <div class="span12"><legend>Content:</legend></div>
                </div>
                <div class="row-fluid">
                    <div class="span2">Title</div>
                    <div class="span9 long-input">{{form.title}}</div>
                </div>
                <div class="row-fluid">
                    <div class="span12 well">
                        <textarea id="id_body" name="body">
                            {{form.instance.body}}
                        </textarea>
                    </div>
                </div>
                {# {% include "articles/article_body.html" %} #}
            {% endif %}
            {% if article.pk %}
                <div class="row-fluid">
                    <div class="span12"><legend>Last Action:</legend></div>
                </div>
                <div class="row-fluid">
                    <div class="span12">{{article.last_action}}</div>
                </div>
            {% endif %}
        </form>
    </div>
{% endblock %}
