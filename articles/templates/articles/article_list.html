{% extends 'articles/base.html' %}
{% load actions %}
{% load show_more %}
{% block multiactions %}
  <li><a href="{% url article_add %}">Add Article</a></li>
  {% include "articles/action_bar.html"%}
{% endblock multiactions %}
{% block content %}
  <div class="row-fluid">
    <div class="span10">
      {% for filter in filters %}
        <span class="label label-primary label-large">{{filter}} <span class="fui-cross"></span></span> 
      {% endfor %}
    </div>
    <div class="span2">
      {% include "articles/show_more_widget.html" %}
    </div>
  </div>
  <div class="block-fluid table-sorting" style="border:none; ">
    <form class="actions-form" id="actions-form" method="post" action="">{% csrf_token %}
      <table cellpadding="0" cellspacing="0" width="100%" class="table" id="articles">
        <thead>
          <tr class="table-header-row">
            <th width="3%">
              <label class="checkbox" for="checkall"><input type="checkbox" value="" id="checkall" data-toggle="checkbox" onChange="toggleMaster();"</label>
            </th>
            <th class="column-header project-column">Project</th>
            <th class="column-header keyword-column">Keywords</th>
            <th class="column-header writer-column">Writer</th>
            <th class="column-header reviewer-column">Reviewer</th>
            <th class="column-header type-column">Type</th>
            <th class="column-header category-column">Category</th>
            <th class="column-header length-column">Length</th>
            <th class="column-header priority-column">Priority</th>
            <th class="column-header tags-column">Tags</th>       
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for article in object_list %}
            {% include "articles/article_list_row.html" %}
          {% endfor %}
        </tbody>
      </table>
    </form>
  </div>
  <div id="tag-modal" class="modal hide fade">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3>Change Tags</h3>
    </div>
    <div class="modal-body">
      <p>List the tags for this article separated by commas.</p>
      <input id="tag_input" name="tags" value="{{article.tags_as_str}}">
    </div>
    <div class="modal-footer">
      <a href="#" class="btn btn-primary" onclick="saveTags();return false;">Save</a>
      <a href="#" class="btn btn-primary" onclick="$('#tag-modal').modal('hide');">Cancel</a>
    </div>
  </div>
  <div id="reject-modal" class="modal hide fade">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3>Reject Article</h3>
    </div>
    <div class="modal-body">
      <p>Please provide a brief explanation for rejecting the article.</p>
      <input id="reject_input">
      <p><input type="checkbox" name="return_to_writer" id="id_return_to_writer" /> Return the article to the writer? Otherwise the content will be erased and the article will be made available to other writers.</p>
      
    </div>
    <div class="modal-footer">
      <a href="#" class="btn btn-primary" onclick="rejectArticle('{% url reject_articles%}', window.article_id);return false;">Save</a>
      <a href="#" class="btn btn-primary" onclick="$('#reject-modal').modal('hide');">Cancel</a>
    </div>
  </div>
  <div id="delete-modal" class="modal hide fade">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3>Delete Article</h3>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to delete this article?</p>
    </div>
    <div class="modal-footer">
      <a href="#" class="btn btn-primary" onclick="$('#delete-modal').modal('hide');doActionOnArticles('{% url delete_articles %}');return false;">Yes</a>
      <a href="#" class="btn btn-primary" onclick="$('#delete-modal').modal('hide');">No</a>
    </div>
  </div>
{% endblock %}
{% block js %}
  <script type='text/javascript' src='{{STATIC_URL}}js/actions.js'></script>
  <script type='text/javascript' src='{{STATIC_URL}}js/ajax.js'></script>
    <script type = "text/javascript" src='{{STATIC_URL}}js/checkboxes.js'></script>
  <script>
    function showColumn(section_id){
        var index = window.hidden_columns.indexOf(section_id);
        window.hidden_columns.splice(index, 1);
        $('.'+section_id+'-column').show();
        $('#'+section_id+'-option').hide();
        if($('.show-columns-option:visible').length == 0){$('#show-columns-selector').hide();}
    }
    function hideColumns(){
      for (var i = 0; i<window.hidden_columns.length; i++){
        $('.'+ window.hidden_columns[i] + '-column').hide();
      }
    }
    $(document).ready(function(){
      $('.dropdown-menu .dropdown-submenu').click(function(e) {
          // e.stopPropagation();
      });
      window.row_selector='.article';
      showOrHideActionBar();
      checked_rows = $('.article :checked');
      if (checked_rows.length>0){selectRows(checked_rows.parents('tr'));}
      $('.tag-popover').popover(html=true, content=$('#tag-popover-html'));
      window.hidden_columns = ['category','length','priority','tags','type','reviewer'];
      hideColumns();
      window.codeForRows=[hideColumns];
    });
    function make_unavailable(assignment){
      if (assignment=="writer"){
        doActionOnArticles('{% url make_unavailable_to_writers %}');
      }else{
        doActionOnArticles('{% url make_unavailable_to_reviewers %}');
      }
    }
    function make_available(assignment){
      if (assignment=="writer"){
        doActionOnArticles('{% url make_available_to_all_writers %}');
      }else{
        doActionOnArticles('{% url make_available_to_all_reviewers %}');
      }
    }
    function make_available_to(assignment, name){
      if (assignment=="writer"){
        doActionOnArticles('{% url make_available_to_writer %}', undefined, "&name="+name);
      }else{
        doActionOnArticles('{% url make_available_to_reviewer %}', undefined, "&name="+name);
      }
    }
    function assign_user(assignment, id, name){
      if (assignment=="writer"){
        doActionOnArticles('{% url assign_to_writer %}', undefined, "&user="+id);
      }else{
        doActionOnArticles('{% url assign_to_reviewer %}', undefined, "&user="+id);
      }
        
    }
  </script>
{% endblock js %}